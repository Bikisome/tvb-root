FROM continuumio/miniconda3:master-nanoserver

# Set our shell to became cmd
SHELL ["cmd", "/S", "/C"]

# Prepare tvb-run env
RUN activate && conda update -n base -c defaults conda
RUN activate && conda create -y --name tvb-run python=3.10 numba scipy numpy cython psycopg2
RUN activate && conda install -y --name tvb-run -c conda-forge jupyterlab tvb-gdist
RUN activate tvb-run && pip install --upgrade pip
RUN activate tvb-run && pip install lockfile scikit-build
RUN activate tvb-run && pip install syncrypto
RUN activate tvb-run && pip install -U numpy


# Download and install tvb data
RUN mkdir %userprofile%\\TVB_CODE
WORKDIR %userprofile%/TVB_CODE
ADD https://zenodo.org/record/4263723/files/tvb_data.zip?download=1 tvb_data.zip
RUN tar -xf tvb_data.zip && dir && del tvb_data.zip
RUN activate tvb-run && python setup.py develop

COPY requirements_group requirements.txt
RUN activate tvb-run && pip install -r requirements.txt

RUN mkdir %userprofile%\\TVB_TEST
RUN mkdir %userprofile%\\.tvb-temp

CMD ["cmd", "activate tvb-run"]